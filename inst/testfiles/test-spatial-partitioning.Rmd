---
title: "R Notebook"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

+ add argument `spatial` to store coords within task so that coords are passed over to makeResampleDesc in the end

```{r}
data(basque, package = "sperrorest")
basque$geometry <- NULL
task <- makeClassifTask(id = "pathogen_data", data = basque, 
                        target = "diplo01", positive = "1",
                        spatial = TRUE)


task <- bc.task.spatial

# does not really work for some reason -> drops more columns than just one
# task_ec <- dropFeatures(task_ec, "fus01")
getTaskDesc(task)
```

`rdesc_ec` nur Description of resample setting
actual resampling done in `resample()`

```{r}
rdesc_ec <- makeResampleDesc("SpCV", iters = 5)
```

```{r}
rdesc_ec_rep <- makeResampleDesc("SpRepCV", fold = 5, reps = 10)
```

```{r}
lrn_ec <- makeLearner("classif.binomial", 
                      link = "logit",
                      predict.type = "prob")
```

calls:

resample (file: resample.R) -> makeResampleInstance (file: ResampleInstance.R) -> instantiateResampleInstance (file: ResampleInstances.R)

```{r}
resa_ec <- resample(learner = lrn_ec, task = task, 
                    resampling = rdesc_ec_rep, measures = list(auc))
```




## create learner object + tuning
```{r}
## Tuning in inner resampling loop
# ps <- makeParamSet(makeDiscreteParam("C", values = 2^(-2:2)),
#                    makeDiscreteParam("sigma", values = 2^(-2:2)))
# ctrl <- makeTuneControlGrid()

ps <- makeParamSet(makeNumericParam("C", lower = 2 ^ -5, upper = 2 ^ 15),
                   makeNumericParam("sigma", lower = 2 ^ -15, upper = 2 ^ 3))

ctrl <- makeTuneControlRandom(maxit = 200)

inner <- makeResampleDesc("CV", iters = 2)

# predict.type for 'auc' (AUROC)
lrn_ec <- makeLearner("classif.ksvm", 
                      predict.type = "prob")

lrn_ksvm <- makeTuneWrapper(lrn_ec, resampling = inner, par.set = ps, 
                            control = ctrl, show.info = F, measures = list(auc))
# getHyperPars(lrn_ksvm)
# getParamSet(lrn_ksvm)
```


```{r}
## Outer resampling loop
outer <- makeResampleDesc("SpRepCV", folds = 3, reps = 2)
resa_ksvm <- resample(lrn_ksvm, task, resampling = outer, extract = getTuneResult, 
                      show.info = T, measures = list(auc))
```

